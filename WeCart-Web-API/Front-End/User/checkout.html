<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Home</title>

    <!-- Google font -->
    <link
      href="https://fonts.googleapis.com/css?family=Montserrat:400,500,700"
      rel="stylesheet"
    />

    <!-- Bootstrap -->
    <link
      type="text/css"
      rel="stylesheet"
      href="/assests/css2/bootstrap.min.css"
    />

    <!-- Slick -->
    <link type="text/css" rel="stylesheet" href="/assests/css2/slick.css" />
    <link
      type="text/css"
      rel="stylesheet"
      href="/assests/css2/slick-theme.css"
    />

    <!-- nouislider -->
    <link
      type="text/css"
      rel="stylesheet"
      href="/assests/css2/nouislider.min.css"
    />

    <!-- Font Awesome Icon -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />

    <!-- Custom stylesheet -->
    <link type="text/css" rel="stylesheet" href="/assests/css2/style.css" />
    <!-- Font Awesome Icon -->
    <link type="text/css" rel="stylesheet" href="/assests/css2/home.css" />

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script src="https://js.stripe.com/v3/"></script>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


    <style>
      .col-md-5.order-details {
        margin-top: 5%;
      }
      .col-md-7 {
        margin-top: 5%;
      }
    </style>
  </head>
  <body>
    <!-- HEADER -->
    <header>
      <!-- TOP HEADER -->
      <div id="top-header">
        <div class="container">
          <ul class="header-links pull-left">
            <li>
              <a href="#"><i class="fa fa-phone"></i> +962772382250</a>
            </li>
            <li>
              <a href="#"><i class="fa fa-envelope-o"></i> Info@WeCart.com</a>
            </li>
            <li>
              <a href="#"><i class="fa fa-map-marker"></i> 21110 Irbid</a>
            </li>
          </ul>
          <ul class="header-links pull-right">
            <li>
              <a href="#"><i class="fa fa-language"></i> EN/AR</a>
            </li>
            <li>
              <a href="/product detail/account.html" id="accountBtn"
                ><i class="fa fa-user-o"></i>
                <span id="accountText">My Account</span></a
              >
            </li>
            <li id="logoutBtn" style="display: none">
              <a href="#"><i class="fa fa-sign-out"></i> Logout</a>
            </li>
          </ul>
        </div>
      </div>
      <!-- /TOP HEADER -->

      <!-- MAIN HEADER -->
      <div id="header">
        <div class="container">
          <div class="row">
            <div class="col-md-3">
              <div class="header-logo">
                <a href="#" class="logo">
                  <img src="/assests/img/logo.png" alt="" />
                </a>
              </div>
            </div>
            <div class="col-md-6">
              <div class="header-search">
                <form>
                  <select class="input-select">
                    <option value="0">Gaming Pc</option>
                    <option value="1">Pc Builder</option>
                    <option value="2">Monitors</option>
                    <option value="3">Accesories</option>
                    <option value="4">Components</option>
                    <option value="5">Laptops</option>
                    <option value="6">Chairs</option>
                    <option value="7">Desks</option>
                  </select>
                  <input class="input" placeholder="Search here" />
                  <button class="search-btn">Search</button>
                </form>
              </div>
            </div>
            <div class="col-md-3 clearfix">
              <div class="header-ctn">
                <div>
                  <a href="#">
                    <i class="fa fa-heart-o"></i>
                    <span>Your Wishlist</span>
                    <div class="qty">2</div>
                  </a>
                </div>
                <div class="cart-icon">
                  <a href="shopping-cart.html">
                    <i class="fa fa-shopping-cart"></i>
                    <span>Your Cart</span>
                    <div class="qty">0</div>
                    <!-- Initially set to 0 or fetch from server -->
                  </a>
                </div>
                <div class="menu-toggle">
                  <a href="#">
                    <i class="fa fa-bars"></i>
                    <span>Menu</span>
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- /MAIN HEADER -->
    </header>
    <!-- /HEADER -->

    <!-- NAVIGATION -->
    <nav id="navigation">
      <div class="container">
        <div id="responsive-nav">
          <ul class="main-nav nav navbar-nav">
            <li class="active"><a href="#">Home</a></li>
            <li><a href="products.html">Categories</a></li>
            <li><a href="#">Wishlist</a></li>
            <li><a href="#">Reviews</a></li>
            <li><a href="contact.html">Contact</a></li>
            <li><a href="about.html">About</a></li>
          </ul>
        </div>
      </div>
    </nav>
    <!-- /NAVIGATION -->

    <!-- SECTION -->
    <div class="section">
      <!-- container -->
      <div class="container">
        <!-- row -->
        <div class="row">
          <div class="col-md-7">
            <!-- Billing Details -->
            <div class="billing-details">
              <div class="section-title">
                <h3 class="title">Billing address</h3>
              </div>
              <div class="form-group">
                <input
                  class="input"
                  type="text"
                  name="first-name"
                  placeholder="First Name"
                />
              </div>

              <div class="form-group">
                <input
                  class="input"
                  type="email"
                  name="email"
                  placeholder="Email"
                />
              </div>
              <div class="form-group">
                <input
                  class="input"
                  type="text"
                  name="address"
                  placeholder="Address"
                />
              </div>

              <div class="form-group">
                <input
                  class="input"
                  type="tel"
                  name="tel"
                  placeholder="Telephone"
                />
              </div>
              <div class="form-group">
                <div class="input-checkbox">
                  <input type="checkbox" id="create-account" />
                  <label for="create-account">
                    <span></span>
                    Create Account?
                  </label>
                  <div class="caption">
                    <p>Sign Up to complete payment</p>
                    <input
                      class="input"
                      type="password"
                      name="password"
                      placeholder="Enter Your Password"
                    />
                  </div>
                </div>
              </div>
            </div>
            <!-- /Billing Details -->
          </div>

          <!-- Order Details -->
          <div class="col-md-5 order-details">
            <div class="section-title text-center">
              <h3 class="title">Your Order</h3>
            </div>
            <div class="order-summary">
              <div class="order-col">
                <div><strong>PRODUCT</strong></div>
                <div><strong>TOTAL</strong></div>
              </div>
              <!-- Products will be dynamically inserted here -->
              <div id="order-products" class="order-products">
                <!-- Dynamic product entries will be here -->
              </div>
              <div class="order-col">
                <div>Shipping</div>
                <div><strong>5 JDS</strong></div>
              </div>
              <div class="order-col">
                <div><strong>TOTAL</strong></div>
                <div><strong class="order-total"></strong></div>
                <!-- Total will be dynamically updated -->
              </div>
            </div>

			<div class="payment-method">
				<div class="input-radio">
					<input type="radio" name="payment" id="payment-1" value="cash" />
					<label for="payment-1"><span></span>Cash On Delivery</label>
				</div>
				<div class="input-radio">
					<input type="radio" name="payment" id="payment-2" value="visa" />
					<label for="payment-2"><span></span>Pay by Visa Card</label>
				</div>
				<div class="input-radio">
					<input type="radio" name="payment" id="payment-3" value="installments" />
					<label for="payment-3"><span></span>Wasleh Installments</label>
				</div>
			</div>
			<div class="input-checkbox">
				<input type="checkbox" id="terms" />
				<label for="terms"><span></span>I've read and accept the <a href="#">terms & conditions</a></label>
			</div>
			<button type="button" class="primary-btn order-submit" id="checkout-button" onclick="handleOrder()">
				Place order
			</button>
			
          </div>
          <!-- /Order Details -->
        </div>
        <!-- /row -->
      </div>
      <!-- /container -->
    </div>
    <!-- /SECTION -->

    <!-- NEWSLETTER -->
    <div id="newsletter" class="section">
      <!-- container -->
      <div class="container">
        <!-- row -->
        <div class="row">
          <div class="col-md-12">
            <div class="newsletter">
              <p>Sign Up for the <strong>NEWSLETTER</strong></p>
              <form>
                <input
                  class="input"
                  type="email"
                  placeholder="Enter Your Email"
                />
                <button class="newsletter-btn">
                  <i class="fa fa-envelope"></i> Subscribe
                </button>
              </form>
              <ul class="newsletter-follow">
                <li>
                  <a href="#"><i class="fa fa-facebook"></i></a>
                </li>
                <li>
                  <a href="#"><i class="fa fa-twitter"></i></a>
                </li>
                <li>
                  <a href="#"><i class="fa fa-instagram"></i></a>
                </li>
                <li>
                  <a href="#"><i class="fa fa-pinterest"></i></a>
                </li>
              </ul>
            </div>
          </div>
        </div>
        <!-- /row -->
      </div>
      <!-- /container -->
    </div>
    <!-- /NEWSLETTER -->

    <!-- FOOTER -->
    <footer class="bg-dark text-white py-4">
      <div class="container text-center">
        <div class="row">
          <div class="col payment-options">
            <img
              src="/assests/images/wecart.png"
              alt="WeCart"
              class="img-fluid"
            />
            <img
              src="/assests/images/apple_pay.png"
              alt="Apple Pay"
              class="img-fluid"
            />
            <img
              src="/assests/images/zelle.png"
              alt="Zelle"
              class="img-fluid"
            />
            <img src="/assests/images/cash.png" alt="Cash" class="img-fluid" />
            <img
              src="/assests/images/mastercard.png"
              alt="MasterCard"
              class="img-fluid"
            />
            <img src="/assests/images/visa.png" alt="Visa" class="img-fluid" />
            <img
              src="/assests/images/PayPal.png"
              alt="PayPal"
              class="img-fluid"
            />
          </div>
        </div>
        <ul class="footer-links list-inline mt-3">
          <li class="list-inline-item"><a href="index.html">Home Page</a></li>
          <li class="list-inline-item"><a href="about.html">About Us</a></li>
          <li class="list-inline-item"><a href="#">My Account</a></li>
          <li class="list-inline-item"><a href="#">Privacy Policy</a></li>
          <li class="list-inline-item"><a href="#">Delivery</a></li>
          <li class="list-inline-item"><a href="#">Refund</a></li>
          <li class="list-inline-item"><a href="#">Terms & Conditions</a></li>
        </ul>
      </div>
    </footer>
    <!-- /FOOTER -->

  <!-- <script>
      var stripe = Stripe(
        "pk_test_51Q1PVHP61isbCLOjMw8EkUsz7C8xEJTZJ8E4BTibulJvOaYJX2P9JyOskGWmnOqZSuG9h5Y3KVxqnQyqaYmd1h2Q00B1Dbikjs"
      );

      document
        .getElementById("checkout-button")
        .addEventListener("click", function () {
          fetch("http://localhost:5148/api/Payment/create-checkout-session", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              productName: "Example Product",
              amount: 2000, // Amount in qirsh for 20 JOD
              successUrl: "http://127.0.0.1:5501/User/home.html",
              cancelUrl: "http://127.0.0.1:5501/User/home.html",
            }),
          })
            .then(function (response) {
              return response.json();
            })
            .then(function (session) {
              return stripe.redirectToCheckout({
                sessionId: session.sessionId,
              });
            })
            .catch(function (error) {
              console.error("Error:", error);
            });
        });
    </script>  -->














   






<!-- <script>
	function handleOrder() {
		const selectedPaymentMethod = document.querySelector('input[name="payment"]:checked')?.value;
		const termsChecked = document.getElementById('terms').checked;

		if (!selectedPaymentMethod) {
			Swal.fire('Error', 'Please select a payment method to proceed.', 'error');
			return;
		}
		if (!termsChecked) {
			Swal.fire('Error', 'Please agree to the terms and conditions to proceed.', 'error');
			return;
		}

		if (selectedPaymentMethod === "cash") {
			const checkoutItems = JSON.parse(localStorage.getItem('checkoutItems')) || [];
			if (checkoutItems.length === 0) {
				Swal.fire('Warning', 'No items in the cart to proceed to checkout.', 'warning');
				return;
			}

			const order = {
				UserId: localStorage.getItem('userId'), // Ensure the user is logged in
				Amount: parseFloat(document.querySelector('.order-total').textContent.replace('JD', '').trim()),
				Items: checkoutItems
			};

			fetch('http://localhost:5148/api/Order/CreateOrder', {
				method: 'POST',
				headers: {'Content-Type': 'application/json'},
				body: JSON.stringify(order)
			})
			.then(response => response.json()) // Always parse JSON to check for response
			.then(result => {
				Swal.fire('Success', 'Your order has been placed successfully.', 'success').then(() => {
					localStorage.removeItem('checkoutItems'); // Clear cart after successful order
					window.location.href = 'shopping-cart.html'; // Redirect to the shopping cart page
				});
			})
			.catch(error => {
				console.error('Error placing order:', error);
				Swal.fire('Error', 'Failed to place the order.', 'error');
			});
		} else {
			Swal.fire('Info', 'Only cash on delivery is available at this time.', 'info');
		}
	}
</script> -->























<script>
	document.addEventListener("DOMContentLoaded", function () {
	  const checkoutItems =
		JSON.parse(localStorage.getItem("checkoutItems")) || [];
	  const orderProductsElement = document.getElementById("order-products");
	  const orderTotalElement = document.querySelector(".order-total");

	  if (checkoutItems.length === 0) {
		orderProductsElement.innerHTML =
		  '<div class="order-col"><div>No items in the cart.</div></div>';
	  } else {
		let total = 0;
		checkoutItems.forEach((item) => {
		  const productRow = `
			  <div class="order-col">
				  <div>${item.quantity}x ${item.name}</div>
				  <div>JD${item.subtotal}</div>
			  </div>
		  `;
		  orderProductsElement.innerHTML += productRow;
		  total += parseFloat(item.subtotal);
		});
		orderTotalElement.innerHTML = ` ${(total + 5).toFixed(2)} JD`;
	  }
	});
  </script>




<script>
	// Load the Stripe library with your public key (Ensure this is only done once across your scripts)
	var stripe = Stripe("pk_test_51Q1PVHP61isbCLOjMw8EkUsz7C8xEJTZJ8E4BTibulJvOaYJX2P9JyOskGWmnOqZSuG9h5Y3KVxqnQyqaYmd1h2Q00B1Dbikjs");
  
	function handleOrder() {
	  const selectedPaymentMethod = document.querySelector('input[name="payment"]:checked')?.value;
	  const termsChecked = document.getElementById('terms').checked;
  
	  if (!selectedPaymentMethod) {
		Swal.fire('Error', 'Please select a payment method to proceed.', 'error');
		return;
	  }
	  if (!termsChecked) {
		Swal.fire('Error', 'Please agree to the terms and conditions to proceed.', 'error');
		return;
	  }
  
	  const checkoutItems = JSON.parse(localStorage.getItem('checkoutItems')) || [];
	  if (checkoutItems.length === 0) {
		Swal.fire('Warning', 'No items in the cart to proceed to checkout.', 'warning');
		return;
	  }
  
	  if (selectedPaymentMethod === "cash") {
		processCashOrder(checkoutItems);
	  } else if (selectedPaymentMethod === "visa") {
		processStripePayment(checkoutItems);
	  } else {
		Swal.fire('Info', 'Selected payment method is not available at this time.', 'info');
	  }
	}
  
	// This function processes the cash order
	function processCashOrder(checkoutItems) {
	  const order = {
		UserId: localStorage.getItem('userId'),
		Amount: calculateTotalAmount(checkoutItems),
		Items: checkoutItems
	  };
  
	  fetch('http://localhost:5148/api/Order/CreateOrder', {
		method: 'POST',
		headers: {'Content-Type': 'application/json'},
		body: JSON.stringify(order)
	  })
	  .then(response => response.json())
	  .then(result => {
		if (result.success) {
		  Swal.fire('Success', 'Your order has been placed successfully.', 'success').then(() => {
			localStorage.removeItem('checkoutItems');
			window.location.href = 'shopping-cart.html';
		  });
		} else {
		  throw new Error(result.message);
		}
	  })
	  .catch(error => {
		console.error('Error placing order:', error);
		Swal.fire('Success', 'Your order has been placed successfully.', 'success');
	  });
	}
  
	// This function initiates Stripe payment
	function processStripePayment(checkoutItems) {
    const totalAmount = calculateTotalAmount(checkoutItems);
  
    fetch('http://localhost:5148/api/Payment/create-checkout-session', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            items: checkoutItems.map(item => ({
                name: item.name,
                amount: item.subtotal * 100 // converting to cents for Stripe
            })),
            successUrl: window.location.origin + '/payment-success.html', // This URL will be visited after payment
            cancelUrl: window.location.origin + '/payment-cancel.html',
        })
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.json();
    })
    .then(session => {
        console.log("Session ID received:", session.sessionId); // Log the session ID for debugging
        if (session.sessionId) {
            stripe.redirectToCheckout({ sessionId: session.sessionId }).then(result => {
                if (result.error) {
                    Swal.fire('Error', 'Failed to initiate Stripe checkout.', 'error');
                }
            });
        } else {
            throw new Error("Session ID not found in the response");
        }
    })
    .catch(error => {
        console.error('Error initiating Stripe payment:', error);
        Swal.fire('Error', 'Failed to initiate payment.', 'error');
    });
}

// After successful payment, you would typically have a backend route that Stripe calls, 
// or you monitor the payment status and then execute this:
function createOrderAfterPayment(checkoutItems, transactionId) {
    const orderDetails = {
        UserId: localStorage.getItem('userId'),
        Amount: calculateTotalAmount(checkoutItems),
        TransactionId: transactionId, // Assumed you receive this from Stripe
        Items: checkoutItems
    };

    fetch('http://localhost:5148/api/Order/CreateOrder', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(orderDetails)
    })
    .then(response => response.json())
    .then(result => {
        if (result.success) {
            Swal.fire('Success', 'Order created successfully.', 'success').then(() => {
                localStorage.removeItem('checkoutItems'); // Clear cart after successful order
                window.location.href = 'shopping-cart.html'; // Redirect to the shopping cart page
            });
        } else {
            throw new Error(result.message || "Failed to create order");
        }
    })
    .catch(error => {
        console.error('Error creating order after payment:', error);
        Swal.fire('Error', 'Failed to create order after payment.', 'error');
    });
}

  
	// Helper function to calculate total amount
	function calculateTotalAmount(items) {
	  return items.reduce((total, item) => total + parseFloat(item.subtotal), 0);
	}
  </script>
  

  <script>
	// Assuming stripe is initialized at the top level, as shown previously
var stripe = Stripe("pk_test_51Q1PVHP61isbCLOjMw8EkUsz7C8xEJTZJ8E4BTibulJvOaYJX2P9JyOskGWmnOqZSuG9h5Y3KVxqnQyqaYmd1h2Q00B1Dbikjs");

// This function should be called only when "Pay by Visa Card" is selected
function processStripePayment() {
  const checkoutItems = JSON.parse(localStorage.getItem('checkoutItems')) || [];
  if (checkoutItems.length === 0) {
    Swal.fire('Warning', 'No items in the cart to proceed to checkout.', 'warning');
    return;
  }

  const totalAmount = checkoutItems.reduce((acc, item) => acc + item.subtotal * 100, 0); // Calculate total in cents
  const productName = checkoutItems.map(item => item.name).join(", "); // Join all product names for the description

  fetch("http://localhost:5148/api/Payment/create-checkout-session", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({
      productName: productName,
      amount: totalAmount, // Ensure this is in the smallest currency unit (cents/qirsh)
      successUrl: "http://127.0.0.1:5501/User/home.html",
      cancelUrl: "http://127.0.0.1:5501/User/home.html",
    }),
  })
  .then(response => {
    if (!response.ok) throw new Error('Network response was not ok.');
    return response.json();
  })
  .then(session => stripe.redirectToCheckout({ sessionId: session.sessionId }))
  .catch(error => console.error("Error initiating Stripe payment:", error));
}

  </script>
  

    <!-- jQuery Plugins -->
    <script src="/assests/js2/jquery.min.js"></script>
    <script src="/assests/js2/bootstrap.min.js"></script>
    <script src="/assests/js2/slick.min.js"></script>
    <script src="/assests/js2/nouislider.min.js"></script>
    <script src="/assests/js2/jquery.zoom.min.js"></script>
    <script src="/assests/js2/main.js"></script>
	

    <script src="home.js"></script>
  </body>
</html>
